<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>rm_controllers: rm_shooter_controller</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">rm_controllers
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">rm_shooter_controller </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="autotoc_md59"></a>
Overview</h1>
<p>The rm_shooter_controller has four states: STOP, READY, PUSH, and BLOCK, it controls the left and right friction wheels and the trigger wheel through PID algorithm according to the command. It can set the bullet speed by setting the angular velocity of the friction wheel, and at the same time realizes the block detection.</p>
<p><b>Keywords:</b> ROS, robomaster, shooter</p>
<h3><a class="anchor" id="autotoc_md60"></a>
License</h3>
<p>The source code is released under a <a href="https://github.com/rm-controls/rm_controllers/blob/master/LICENSE">BSD 3-Clause license</a>.</p>
<p><b>Author: DynamicX<br  />
 Affiliation: DynamicX<br  />
 Maintainer: DynamicX</b></p>
<p>The rm_shooter_controller package has been tested under <a href="http://www.ros.org">ROS</a> Melodic and Noetic on respectively 18.04 and 20.04. This is research code, expect that it changes often and any fitness for a particular purpose is disclaimed.</p>
<h2><a class="anchor" id="autotoc_md61"></a>
Hardware interface type</h2>
<ul>
<li><code>JointStateInterface</code> Used to obtain the speed of friction wheel and trigger wheel and the position of trigger wheel.</li>
<li><code>EffortJointInterface</code> Used to send torque commands for friction wheels and trigger wheel.</li>
</ul>
<h1><a class="anchor" id="autotoc_md62"></a>
Installation</h1>
<h2><a class="anchor" id="autotoc_md63"></a>
Installation from Packages</h2>
<p>To install all packages from this repository as Debian packages use</p>
<div class="fragment"><div class="line">sudo apt-get install ros-noetic-rm-shooter-controllers</div>
</div><!-- fragment --><p>or better use <code>rosdep</code>:</p>
<div class="fragment"><div class="line">sudo rosdep install --from-paths src</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md64"></a>
Building from Source</h2>
<h3><a class="anchor" id="autotoc_md65"></a>
Dependencies</h3>
<ul>
<li>rm_description</li>
<li>roscpp</li>
<li>roslint</li>
<li>rm_msgs</li>
<li>rm_common</li>
<li>pluginlib</li>
<li>controller_interface</li>
<li>hardware_interface</li>
<li>forward_command_controller</li>
<li>realtime_tools</li>
<li>control_toolbox</li>
<li>effort_controllers</li>
<li>dynamic_reconfigure</li>
</ul>
<h3><a class="anchor" id="autotoc_md66"></a>
Building</h3>
<p>To build this package with catkin build. Clone the latest version from this repository into your catkin workspace.</p>
<div class="fragment"><div class="line">catkin_workspace/src</div>
<div class="line">git clone https://github.com/rm-controls/rm_controllers.git</div>
<div class="line">rosdep install --from-paths . --ignore-src</div>
<div class="line">catkin build</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md67"></a>
Usage</h1>
<p>Run the controller with mon launch:</p>
<div class="fragment"><div class="line">mon launch rm_shooter_controllers load_controllers.launch</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md68"></a>
Cfg</h1>
<ul>
<li><b>shooter.cfg:</b> Add parameters related to friction wheel's angular velocity corresponding to each bullet speed and trigger block detection parameters.</li>
</ul>
<h1><a class="anchor" id="autotoc_md69"></a>
Launch files</h1>
<ul>
<li><b>load_controller.launch:</b> Load the parameters in config files and load the shooter controller.</li>
</ul>
<h1><a class="anchor" id="autotoc_md70"></a>
ROS API</h1>
<h3><a class="anchor" id="autotoc_md71"></a>
Subscribed Topics</h3>
<ul>
<li><p class="startli">**<code>command</code>** (rm_msgs/ShootCmd)</p>
<p class="startli">Commands of controller state, bullet speed, frequency of shooting.</p>
</li>
</ul>
<h3><a class="anchor" id="autotoc_md72"></a>
Parameters</h3>
<ul>
<li><p class="startli">**<code>block_effort</code>, <code>block_speed</code>, <code>block_duration</code>** (double)</p>
<p class="startli">When the torque of the trigger motor is greater than <code>block_effort</code> (in NÂ·m), and the angular velocity of trigger motor is less than <code>block_speed</code> (in rad/s), it will be regarded as blocking if it continues for <code>block_duration</code> (in s), and the the state of shooter controller will switch to BLOCK.</p>
</li>
<li><p class="startli">**<code>block_overtime</code>** (double)</p>
<p class="startli">If the time to enter BLOCK state exceeds <code>block_overtime</code> (in s), the state of shooter controller will switch to PUSH.</p>
</li>
<li><p class="startli">**<code>anti_block_angle</code>** (double)</p>
<p class="startli">If shooter controller enter BLOCK state, the friction wheel will reverse <code>anti_block_angle</code> (in rad) to try to get rid of blocking. When the friction wheel get rid of BLOCK state successfully, the state of shooter controller will switch to PUSH.</p>
</li>
<li><p class="startli">**<code>anti_block_threshold</code>** (double)</p>
<p class="startli">If the anti angle of the friction wheel exceeds <code>anti_block_threshold</code> (in rad), it means that friction wheel reverse successfully.</p>
</li>
<li><p class="startli">**<code>qd_10</code>, <code>qd_15</code>, <code>qd_18</code>, <code>qd_30</code>** (double)</p>
<p class="startli">These parameters mean the friction wheel's angular velocity, the number of it's name expresses different bullet speeds (in m/s).</p>
</li>
</ul>
<h2><a class="anchor" id="autotoc_md73"></a>
Controller configuration examples</h2>
<h3><a class="anchor" id="autotoc_md74"></a>
Complete description</h3>
<div class="fragment"><div class="line">shooter_controller:</div>
<div class="line">    type: rm_shooter_controllers/Controller</div>
<div class="line">    publish_rate: 50</div>
<div class="line">    friction_left:</div>
<div class="line">      joint: &quot;left_friction_wheel_joint&quot;</div>
<div class="line">      pid: { p: 0.001, i: 0.01, d: 0.0, i_clamp_max: 0.01, i_clamp_min: -0.01, antiwindup: true, publish_state: true }</div>
<div class="line">    friction_right:</div>
<div class="line">      joint: &quot;right_friction_wheel_joint&quot;</div>
<div class="line">      pid: { p: 0.001, i: 0.01, d: 0.0, i_clamp_max: 0.01, i_clamp_min: -0.01, antiwindup: true, publish_state: true }</div>
<div class="line">    trigger:</div>
<div class="line">      joint: &quot;trigger_joint&quot;</div>
<div class="line">      pid: { p: 50.0, i: 0.0, d: 1.5, i_clamp_max: 0.0, i_clamp_min: 0.0, antiwindup: true, publish_state: true }</div>
<div class="line">    push_per_rotation: 8</div>
<div class="line">    push_qd_threshold: 0.90</div>
<div class="line">    block_effort: 0.95</div>
<div class="line">    block_duration: 0.05</div>
<div class="line">    block_overtime: 0.5</div>
<div class="line">    anti_block_angle: 0.2</div>
<div class="line">    anti_block_threshold: 0.1</div>
<div class="line">    qd_15: 460.0</div>
<div class="line">    qd_18: 515.0</div>
<div class="line">    qd_30: 740.0</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md75"></a>
Bugs &amp; Feature Requests</h1>
<p>Please report bugs and request features using the <a href="https://github.com/gdut-dynamic-x/simple_chassis_controller/issues">Issue Tracker</a> . </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
