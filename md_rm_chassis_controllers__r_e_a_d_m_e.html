<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>rm_controllers: rm_chassis_controllers</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">rm_controllers
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title"><a class="el" href="namespacerm__chassis__controllers.html">rm_chassis_controllers</a> </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="autotoc_md19"></a>
Overview</h1>
<p>There are four states: raw, follow, gyro and twist. The output torque and speed of each motor of the chassis can be calculated according to the current state of the control, the received speed and pose of the pan/tilt, and the speed and acceleration commands, and the data is returned by the motor to calculate The speed and posture of the chassis are released. The control algorithm involved in the chassis controller is PID algorithm.</p>
<p><b>Keywords:</b> mecanum, swerve, balance, chassis, ROS, RoboMaster</p>
<h2><a class="anchor" id="autotoc_md20"></a>
Hardware interface type</h2>
<ul>
<li><code>JointStateInterface</code> Used to get the position and speed of chassis wheel joint.</li>
<li><code>EffortJointInterface</code> Used to send the torque command of chassis wheel joint.</li>
<li><code>RoboSateInterface</code> Used for high-frequency maintenance of the transformation relationship of changing odom to base_link.</li>
</ul>
<h1><a class="anchor" id="autotoc_md21"></a>
Installation</h1>
<h2><a class="anchor" id="autotoc_md22"></a>
Installation from Packages</h2>
<p>To install all packages from the this repository as Debian packages use</p>
<div class="fragment"><div class="line">sudo apt-get install ros-noetic-rm-chassis-controllers</div>
</div><!-- fragment --><p>Or better, use <code>rosdep</code>:</p>
<div class="fragment"><div class="line">sudo rosdep install --from-paths src</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md23"></a>
Building from Source</h2>
<h3><a class="anchor" id="autotoc_md24"></a>
Dependencies</h3>
<ul>
<li><a href="http://wiki.ros.org/">Robot Operating System (ROS)</a> (middleware for robotics),</li>
<li>roscpp</li>
<li>roslint</li>
<li>rm_msgs</li>
<li>rm_common</li>
<li>pluginlib</li>
<li>hardware_interface</li>
<li>controller_interface</li>
<li>forward_command_controller</li>
<li>realtime_tools</li>
<li>control_toolbox</li>
<li>effort_controllers</li>
<li>tf2</li>
<li>tf2_geometry_msgs</li>
<li>angles</li>
<li>imu_sensor_controller</li>
<li>robot_localization</li>
</ul>
<h3><a class="anchor" id="autotoc_md25"></a>
Building</h3>
<ul>
<li>Build this package with catkin build. Clone the latest version from this repository into your catkin workspace.</li>
</ul>
<div class="fragment"><div class="line">catkin_workspace/src</div>
<div class="line">git clone https://github.com/rm-controls/rm_controllers.git</div>
<div class="line">rosdep install --from-paths . --ignore-src</div>
<div class="line">catkin build</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md26"></a>
Usage</h1>
<p>Run the controller with mon launch:</p>
<div class="fragment"><div class="line">mon launch rm_chassis_controllers load_controllers.launch</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md27"></a>
Launch files</h1>
<ul>
<li><b>load_controllers.launch:</b> It loads tf, robot_localization and some controllers, <a class="el" href="namespacerobot__state__controller.html">robot_state_controller</a>, joint_state_controller and chassis controller are included.</li>
</ul>
<h1><a class="anchor" id="autotoc_md28"></a>
ROS API</h1>
<h3><a class="anchor" id="autotoc_md29"></a>
Subscribed Topics</h3>
<ul>
<li><p class="startli">**<code>base_imu</code>** (<a href="http://docs.ros.org/en/api/sensor_msgs/html/msg/Imu.html">sensor_msgs/Imu</a>)</p>
<p class="startli">The inertial measurement unit data of base command.</p>
</li>
<li><p class="startli">**<code>command</code>** (rm_msgs::ChassisCmd)</p>
<p class="startli">Set the mode, acceleration, and maximum power of the chassis.</p>
</li>
<li><p class="startli">**<code>cmd_vel</code>** (<a href="http://docs.ros.org/en/api/geometry_msgs/html/msg/Twist.html">geometry_msgs/Twist</a>)</p>
<p class="startli">Set the speed of the chassis.</p>
</li>
</ul>
<h3><a class="anchor" id="autotoc_md30"></a>
Published Topics</h3>
<ul>
<li><p class="startli">**<code>odom</code>**(<a href="http://docs.ros.org/en/api/nav_msgs/html/msg/Odometry.html">nav_msgs/Odometry</a>)</p>
<p class="startli">Chassis odometer information (speed, position, covariance).</p>
</li>
</ul>
<h3><a class="anchor" id="autotoc_md31"></a>
Parameters</h3>
<h4><a class="anchor" id="autotoc_md32"></a>
common</h4>
<ul>
<li><p class="startli">**<code>wheel_radius</code>** (double)</p>
<p class="startli">Radius of the wheels.</p>
</li>
<li><p class="startli">**<code>wheel_track</code>** (double)</p>
<p class="startli">The distance between the center of the left and right wheels on the same side.</p>
</li>
<li><p class="startli">**<code>wheel_base</code>** (double)</p>
<p class="startli">The distance between the center of the front and rear wheels on the same side.</p>
</li>
<li><p class="startli">**<code>twist_angle</code>** (double)</p>
<p class="startli">Amplitude of twist at <code>twist</code> state.</p>
</li>
<li><p class="startli">**<code>enable_odom_tf</code>** (bool, default: true)</p>
<p class="startli">Option.If set this param true, it will send Transform from odom to base.</p>
</li>
<li><p class="startli">**<code>twist_covariance_diagonal</code>** (double[6])</p>
<p class="startli">The diagonal covariance matrix of twist.</p>
</li>
<li><p class="startli">**<code>publish_rate</code>** (double, default: 50)</p>
<p class="startli">Frequency (in Hz) of publishing Transform.</p>
</li>
<li><p class="startli">**<code>coeff</code>** (double)</p>
<p class="startli">A coefficient. Adjust this coefficient to reduce the impact of power loss.</p>
</li>
<li><p class="startli">**<code>min_vel</code>** (double)</p>
<p class="startli">The minimum velocity of chassis joint which is used to calculate the max torque.</p>
</li>
<li><p class="startli">**<code>timeout</code>** (double)</p>
<p class="startli">Allowed period (in s) between two commands. If the time is exceed this period, the speed of chassis will be set 0.</p>
</li>
</ul>
<h4><a class="anchor" id="autotoc_md33"></a>
Balance</h4>
<ul>
<li><p class="startli">**<code>joint_left_name</code>** (string, default: "joint_left")</p>
<p class="startli">Left wheel joint name or list of joint names.</p>
</li>
<li><p class="startli">**<code>joint_right_name</code>** (string, default: "joint_right")</p>
<p class="startli">Right wheel joint name or list of joint names.</p>
</li>
<li><p class="startli">**<code>com_pitch_offset</code>** (double, default: 0)</p>
<p class="startli">The reduction ratio of pitch.</p>
</li>
<li><p class="startli">**<code>a</code>** (double[16])</p>
<p class="startli">State space expression.</p>
</li>
<li><p class="startli">**<code>b</code>** (double[8])</p>
<p class="startli">State space expression.</p>
</li>
<li><p class="startli">**<code>q</code>** (double[16])</p>
<p class="startli">Weight matrix.</p>
</li>
<li><p class="startli">**<code>r</code>** (double[4])</p>
<p class="startli">Weight matrix.</p>
</li>
</ul>
<h4><a class="anchor" id="autotoc_md34"></a>
Swerve</h4>
<ul>
<li><p class="startli">**<code>/modules/&lt;module_name&gt;/position</code>** (double[2])</p>
<p class="startli">The position of module.</p>
</li>
<li><p class="startli">**<code>/modules/&lt;module_name&gt;/pivot/joint</code>** (string)</p>
<p class="startli">Joint between chassis and privot.</p>
</li>
<li><p class="startli">**<code>/modules/&lt;module_name&gt;/pivot/offset</code>** (double)</p>
<p class="startli">Angle between the wheel rotation axis and the chassis's Y axis.</p>
</li>
<li><p class="startli">**<code>/modules/&lt;module_name&gt;/wheel/joint</code>** (string)</p>
<p class="startli">Joint between privot and wheel.</p>
</li>
<li><p class="startli">**<code>/modules/&lt;module_name&gt;/wheel/radius</code>** (double)</p>
<p class="startli">The radius of wheel.</p>
</li>
</ul>
<h1><a class="anchor" id="autotoc_md35"></a>
Controller configuration examples</h1>
<h2><a class="anchor" id="autotoc_md36"></a>
Complete description</h2>
<div class="fragment"><div class="line">chassis_controller:</div>
<div class="line">    type: rm_chassis_controllers/MecanumController</div>
<div class="line">    publish_rate: 100</div>
<div class="line">    enable_odom_tf: true</div>
<div class="line">    wheel_radius: 0.07625</div>
<div class="line">    left_front:</div>
<div class="line">      joint: &quot;left_front_wheel_joint&quot;</div>
<div class="line">      pid: { p: 0.8, i: 0, d: 0.0, i_max: 0.0, i_min: 0.0, antiwindup: true, publish_state: true }</div>
<div class="line">    right_front:</div>
<div class="line">      joint: &quot;right_front_wheel_joint&quot;</div>
<div class="line">      pid: { p: 0.8, i: 0, d: 0.0, i_max: 0.0, i_min: 0.0, antiwindup: true, publish_state: true }</div>
<div class="line">    left_back:</div>
<div class="line">      joint: &quot;left_back_wheel_joint&quot;</div>
<div class="line">      pid: { p: 0.8, i: 0, d: 0.0, i_max: 0.0, i_min: 0.0, antiwindup: true, publish_state: true }</div>
<div class="line">    right_back:</div>
<div class="line">      joint: &quot;right_back_wheel_joint&quot;</div>
<div class="line">      pid: { p: 0.8, i: 0, d: 0.0, i_max: 0.0, i_min: 0.0, antiwindup: true, publish_state: true }</div>
<div class="line">    twist_covariance_diagonal: [ 0.001, 0.001, 0.001, 0.001, 0.001, 0.001 ]</div>
<div class="line">    wheel_base: 0.395</div>
<div class="line">    wheel_track: 0.374</div>
<div class="line">    power:</div>
<div class="line">      coeff: 0.535</div>
<div class="line">      min_vel: 4.4</div>
<div class="line">    twist_angular: 0.5233</div>
<div class="line">    timeout: 0.1</div>
<div class="line">    pid_follow: { p: 5, i: 0, d: 0.8, i_max: 0.0, i_min: 0.0, antiwindup: true, publish_state: true }</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md37"></a>
Bugs &amp; Feature Requests</h1>
<p>Please report bugs and request features using the <a href="https://github.com/rm-controls/rm_controllers/issues">Issue Tracker</a>. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
